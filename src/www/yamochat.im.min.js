window.RTCMultiConnection=function(a,b){function c(a,b){var c="";c+="?userid="+a.userid,c+="&sessionid="+a.sessionid,c+="&msgEvent="+a.socketMessageEvent,c+="&socketCustomEvent="+a.socketCustomEvent,c+="&autoCloseEntireSession="+!!a.autoCloseEntireSession,c+="&maxParticipantsAllowed="+a.maxParticipantsAllowed,a.enableScalableBroadcast&&(c+="&enableScalableBroadcast=true",c+="&maxRelayLimitPerUser="+(a.maxRelayLimitPerUser||2)),a.socketCustomParameters&&(c+=a.socketCustomParameters);try{io.sockets={}}catch(a){}if(a.socketURL||(a.socketURL="http://localhost:9001/"),"/"!=a.socketURL.substr(a.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';a.enableLogs&&("/"==a.socketURL?console.info("socket.io is connected at: ",location.origin+"/"):console.info("socket.io is connected at: ",a.socketURL));try{a.socket=io(a.socketURL+c)}catch(b){a.socket=io.connect(a.socketURL+c,a.socketOptions)}a.socket.isIO=!0;var d=a.multiPeersHandler;a.socket.on("extra-data-updated",function(b,c){a.peers[b]&&(a.peers[b].extra=c,a.onExtraDataUpdated({userid:b,extra:c}),a.peersBackup[b]||(a.peersBackup[b]={userid:b,extra:{}}),a.peersBackup[b].extra=c)}),a.socket.on(a.socketMessageEvent,function(b){if(b.remoteUserId==a.userid){if(a.peers[b.sender]&&a.peers[b.sender].extra!=b.message.extra&&(a.peers[b.sender].extra=b.extra,a.onExtraDataUpdated({userid:b.sender,extra:b.extra})),b.message.streamSyncNeeded&&a.peers[b.sender]){var c=a.streamEvents[b.message.streamid];if(!c||!c.stream)return;var e=b.message.action;if("ended"===e||"inactive"===e||"stream-removed"===e)return a.peersBackup[c.userid]&&(c.extra=a.peersBackup[c.userid].extra),void a.onstreamended(c);var f="both"!=b.message.type?b.message.type:null;return void("function"==typeof c.stream[e]&&c.stream[e](f))}if("connectWithAllParticipants"===b.message)return-1===a.broadcasters.indexOf(b.sender)&&a.broadcasters.push(b.sender),void d.onNegotiationNeeded({allParticipants:a.getAllParticipants(b.sender)},b.sender);if("removeFromBroadcastersList"===b.message)return void(-1!==a.broadcasters.indexOf(b.sender)&&(delete a.broadcasters[a.broadcasters.indexOf(b.sender)],a.broadcasters=v(a.broadcasters)));if("isMod"===b.message)return!1;if("dropPeerConnection"===b.message)return void a.deletePeer(b.sender);if(b.message.allParticipants)return-1===b.message.allParticipants.indexOf(b.sender)&&b.message.allParticipants.push(b.sender),void b.message.allParticipants.forEach(function(b){d[a.peers[b]?"renegotiatePeer":"createNewPeer"](b,{localPeerSdpConstraints:{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:w(a.session)})});if(b.message.newParticipant){if(b.message.newParticipant==a.userid)return;if(a.peers[b.message.newParticipant])return;return void d.createNewPeer(b.message.newParticipant,b.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:w(a.session)})}if((b.message.readyForOffer||b.message.addMeAsBroadcaster)&&a.addNewBroadcaster(b.sender),b.message.newParticipationRequest&&b.sender!==a.userid){a.peers[b.sender]&&a.deletePeer(b.sender);var g={extra:b.extra||{},localPeerSdpConstraints:b.message.remotePeerSdpConstraints||{OfferToReceiveAudio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:b.message.localPeerSdpConstraints||{OfferToReceiveAudio:a.session.oneway?!!a.session.audio:a.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a.session.oneway?!!a.session.video||!!a.session.screen:a.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction,isDataOnly:void 0!==b.message.isDataOnly?b.message.isDataOnly:w(a.session),dontGetRemoteStream:void 0!==b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction,dontAttachLocalStream:!!b.message.dontGetRemoteStream,connectionDescription:b,successCallback:function(){(void 0!==b.message.isOneWay?b.message.isOneWay:!!a.session.oneway||"one-way"===a.direction)&&a.addNewBroadcaster(b.sender,g),(a.session.oneway||"one-way"===a.direction||w(a.session))&&a.addNewBroadcaster(b.sender,g)}};return void a.onNewParticipant(b.sender,g)}if(b.message.shiftedModerationControl)return void a.onShiftedModerationControl(b.sender,b.message.broadcasters);if(b.message.changedUUID&&a.peers[b.message.oldUUID]&&(a.peers[b.message.newUUID]=a.peers[b.message.oldUUID],delete a.peers[b.message.oldUUID]),b.message.userLeft)return d.onUserLeft(b.sender),void(b.message.autoCloseEntireSession&&a.leave());d.addNegotiatedMessage(b.message,b.sender)}}),a.socket.on("user-left",function(b){onUserLeft(b),a.onUserStatusChanged({userid:b,status:"offline",extra:a.peers[b]?a.peers[b].extra||{}:{}});var c={userid:b,extra:{}};a.peersBackup[c.userid]&&(c.extra=a.peersBackup[c.userid].extra),a.onleave(c)});var e=!1;a.socket.resetProps=function(){e=!1},a.socket.on("connect",function(){e||(e=!0,a.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){a.socket.emit("extra-data-updated",a.extra),b&&b(a.socket)},1e3))}),a.socket.on("disconnect",function(){a.enableLogs&&console.warn("socket.io connection is closed")}),a.socket.on("join-with-password",function(b){a.onJoinWithPassword(b)}),a.socket.on("invalid-password",function(b,c){a.onInvalidPassword(b,c)}),a.socket.on("password-max-tries-over",function(b){a.onPasswordMaxTriesOver(b)}),a.socket.on("user-disconnected",function(b){b!==a.userid&&(a.onUserStatusChanged({userid:b,status:"offline",extra:a.peers[b]?a.peers[b].extra||{}:{}}),a.deletePeer(b))}),a.socket.on("user-connected",function(b){b!==a.userid&&a.onUserStatusChanged({userid:b,status:"online",extra:a.peers[b]?a.peers[b].extra||{}:{}})}),a.socket.on("closed-entire-session",function(b,c){a.leave(),a.onEntireSessionClosed({sessionid:b,userid:b,extra:c})}),a.socket.on("userid-already-taken",function(b,c){a.isInitiator=!1,a.userid=c,a.onUserIdAlreadyTaken(b,c)}),a.socket.on("logs",function(b){a.enableLogs}),a.socket.on("number-of-broadcast-viewers-updated",function(b){a.onNumberOfBroadcastViewersUpdated(b)}),a.socket.on("room-full",function(b){a.onRoomFull(b)}),a.socket.on("become-next-modrator",function(b){b==a.sessionid&&setTimeout(function(){a.open(b),a.socket.emit("shift-moderator-control-on-disconnect")},1e3)})}function d(a){function e(){a.fbr=new FileBufferReader,a.fbr.onProgress=function(b){a.onFileProgress(b)},a.fbr.onBegin=function(b){a.onFileStart(b)},a.fbr.onEnd=function(b){a.onFileEnd(b)}}var b=this,c=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];a.peersBackup={},a.peers={getLength:function(){var a=0;for(var b in this)-1==c.indexOf(b)&&a++;return a},selectFirst:function(){var a;for(var b in this)-1==c.indexOf(b)&&(a=this[b]);return a},getAllParticipants:function(a){var b=[];for(var d in this)-1==c.indexOf(d)&&d!=a&&b.push(d);return b},forEach:function(b){this.getAllParticipants().forEach(function(c){b(a.peers[c])})},send:function(c,d){var e=this;if(!x(c.size)&&!x(c.type))return void b.shareFile(c,d);if(!("text"===c.type||c instanceof ArrayBuffer||c instanceof DataView))return void $.send({text:c,channel:this,connection:a,remoteUserId:d});if("text"===c.type&&(c=JSON.stringify(c)),d){var f=a.peers[d];if(f)return f.channels.length?void f.channels.forEach(function(a){a.send(c)}):(a.peers[d].createDataChannel(),a.renegotiate(d),void setTimeout(function(){e.send(c,d)},3e3))}this.getAllParticipants().forEach(function(b){if(!e[b].channels.length)return a.peers[b].createDataChannel(),a.renegotiate(b),void setTimeout(function(){e[b].channels.forEach(function(a){a.send(c)})},3e3);e[b].channels.forEach(function(a){a.send(c)})})}},this.uuid=a.userid,this.getLocalConfig=function(c,d,f){return f||(f={}),{streamsToShare:f.streamsToShare||{},rtcMultiConnection:a,connectionDescription:f.connectionDescription,userid:d,localPeerSdpConstraints:f.localPeerSdpConstraints,remotePeerSdpConstraints:f.remotePeerSdpConstraints,dontGetRemoteStream:!!f.dontGetRemoteStream,dontAttachLocalStream:!!f.dontAttachLocalStream,renegotiatingPeer:!!f.renegotiatingPeer,peerRef:f.peerRef,channels:f.channels||[],onLocalSdp:function(a){b.onNegotiationNeeded(a,d)},onLocalCandidate:function(c){(c=L.processCandidates(a,c))&&b.onNegotiationNeeded(c,d)},remoteSdp:c,onDataChannelMessage:function(c){if(!a.fbr&&a.enableFileSharing&&e(),"string"==typeof c||!a.enableFileSharing)return void b.onDataChannelMessage(c,d);var f=this;return c instanceof ArrayBuffer||c instanceof DataView?void a.fbr.convertToObject(c,function(a){f.onDataChannelMessage(a)}):c.readyForNextChunk?void a.fbr.getNextChunk(c,function(b,c){a.peers[d].channels.forEach(function(a){a.send(b)})},d):c.chunkMissing?void a.fbr.chunkMissing(c):void a.fbr.addChunk(c,function(b){a.peers[d].peer.channel.send(b)})},onDataChannelError:function(a){b.onDataChannelError(a,d)},onDataChannelOpened:function(a){b.onDataChannelOpened(a,d)},onDataChannelClosed:function(a){b.onDataChannelClosed(a,d)},onRemoteStream:function(c){if(a.peers[d]&&a.peers[d].streams.push(c),k&&window.PluginRTC){var e=document.createElement("video"),f=a.videosContainer;return f.insertBefore(e,f.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(e,c)},3e3)}b.onGettingRemoteMedia(c,d)},onRemoteStreamRemoved:function(a){b.onRemovingRemoteMedia(a,d)},onPeerStateChanged:function(a){b.onPeerStateChanged(a),"new"===a.iceConnectionState&&b.onNegotiationStarted(d,a),"connected"===a.iceConnectionState&&b.onNegotiationCompleted(d,a),-1!==a.iceConnectionState.search(/closed|failed/gi)&&(b.onUserLeft(d),b.disconnectWith(d))}}},this.createNewPeer=function(b,c){if(!(a.maxParticipantsAllowed<=a.getAllParticipants().length)){if(c=c||{},a.isInitiator&&a.session.audio&&"two-way"===a.session.audio&&!c.streamsToShare&&(c.isOneWay=!1,c.isDataOnly=!1,c.session=a.session),!c.isOneWay&&!c.isDataOnly)return c.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:c},b);c=a.setUserPreferences(c,b);var d=this.getLocalConfig(null,b,c);a.peers[b]=new J(d)}},this.createAnsweringPeer=function(b,c,d){d=a.setUserPreferences(d||{},c);var e=this.getLocalConfig(b,c,d);a.peers[c]=new J(e)},this.renegotiatePeer=function(b,c,d){if(!a.peers[b])return void(a.enableLogs&&console.error("This peer ("+b+") does not exist. Renegotiation skipped."));c||(c={}),c.renegotiatingPeer=!0,c.peerRef=a.peers[b].peer,c.channels=a.peers[b].channels;var e=this.getLocalConfig(d,b,c);a.peers[b]=new J(e)},this.replaceTrack=function(b,c,d){if(!a.peers[c])throw"This peer ("+c+") does not exist.";var e=a.peers[c].peer;if(e.getSenders&&"function"==typeof e.getSenders&&e.getSenders().length)return void e.getSenders().forEach(function(e){d&&e.track instanceof VideoStreamTrack&&(a.peers[c].peer.lastVideoTrack=e.track,e.replaceTrack(b)),!d&&e.track instanceof AudioStreamTrack&&(a.peers[c].peer.lastAudioTrack=e.track,e.replaceTrack(b))});console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(c)},this.onNegotiationNeeded=function(a,b){},this.addNegotiatedMessage=function(c,e){if(c.type&&c.sdp)return"answer"==c.type&&a.peers[e]&&a.peers[e].addRemoteSdp(c),"offer"==c.type&&(c.renegotiatingPeer?this.renegotiatePeer(e,null,c):this.createAnsweringPeer(c,e)),void a.enableLogs;if(c.candidate)return a.peers[e]&&a.peers[e].addRemoteCandidate(c),void a.enableLogs;if(c.enableMedia){a.session=c.userPreferences.session||a.session,a.session.oneway&&a.attachStreams.length&&(a.attachStreams=[]),c.userPreferences.isDataOnly&&a.attachStreams.length&&(a.attachStreams.length=[]);var f={};a.attachStreams.forEach(function(a){f[a.streamid]={isAudio:!!a.isAudio,isVideo:!!a.isVideo,isScreen:!!a.isScreen}}),c.userPreferences.streamsToShare=f,b.onNegotiationNeeded({readyForOffer:!0,userPreferences:c.userPreferences},e)}c.readyForOffer&&a.onReadyForOffer(e,c.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(c,d,e){if(!a.socket.isIO&&(e=(e||"").split("|-,-|"),e.length)){var f,g=[];e.forEach(function(a){a=(a||"").replace(/ /g,""),a.length&&(f?g.push(a):f=a)}),f&&(b.onNegotiationNeeded({newParticipant:c,userPreferences:d||!1},f),g.length&&setTimeout(function(){b.connectNewParticipantWithAllBroadcasters(c,d,g.join("|-,-|"))},3e3))}},this.onGettingRemoteMedia=function(a,b){},this.onRemovingRemoteMedia=function(a,b){},this.onGettingLocalMedia=function(a){},this.onLocalMediaError=function(b,c){a.onMediaError(b,c)},this.shareFile=function(b,c){if(!a.enableFileSharing)throw'"connection.enableFileSharing" is false.';e(),a.fbr.readAsArrayBuffer(b,function(b){var d=a.getAllParticipants();c&&(d=[c]),d.forEach(function(c){a.fbr.getNextChunk(b,function(b){a.peers[c].channels.forEach(function(a){a.send(b)})},c)})},{userid:a.userid,chunkSize:f?15e3:a.chunkSize||0})};var g=new Z(a);this.onDataChannelMessage=function(b,c){g.receive(JSON.parse(b),c,a.peers[c]?a.peers[c].extra:{})},this.onDataChannelClosed=function(b,c){b.userid=c,b.extra=a.peers[c]?a.peers[c].extra:{},a.onclose(b)},this.onDataChannelError=function(b,c){b.userid=c,event.extra=a.peers[c]?a.peers[c].extra:{},a.onerror(b)},this.onDataChannelOpened=function(b,c){if(a.peers[c].channels.length)return void(a.peers[c].channels=[b]);a.peers[c].channels.push(b),a.onopen({userid:c,extra:a.peers[c]?a.peers[c].extra:{},channel:b})},this.onPeerStateChanged=function(b){a.onPeerStateChanged(b)},this.onNegotiationStarted=function(a,b){},this.onNegotiationCompleted=function(a,b){},this.getRemoteStreams=function(b){return b=b||a.peers.getAllParticipants()[0],a.peers[b]?a.peers[b].streams:[]},this.isPluginRTC=a.isPluginRTC=k}function p(a,b,c){if("undefined"!=typeof CustomEvent){var d={arguments:c,__exposedProps__:c},e=new CustomEvent(b,d);a.dispatchEvent(e)}}function q(a,b){if(!a||!b)throw"Both arguments are required.";if(a.onspeaking&&a.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(b.stream,{onspeaking:function(){a.onspeaking(b)},onsilence:function(){a.onsilence(b)},onvolumechange:function(c,d){a.onvolumechange&&a.onvolumechange(merge({volume:c,threshold:d},b))}})}}function r(a,b){b.stream&&b.stream&&b.stream.addEventListener&&(b.stream.addEventListener("mute",function(c){c=a.streamEvents[b.streamid],c.session={audio:"audio"===c.muteType,video:"video"===c.muteType},a.onmute(c)},!1),b.stream.addEventListener("unmute",function(c){c=a.streamEvents[b.streamid],c.session={audio:"audio"===c.unmuteType,video:"video"===c.unmuteType},a.onunmute(c)},!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var a=window.crypto.getRandomValues(new Uint32Array(3)),b="",c=0,d=a.length;c<d;c++)b+=a[c].toString(36);return b}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function t(a,b,c){var d=!1;a.getVideoTracks&&!a.getVideoTracks().length&&(d=!0);var e=document.createElement(d?"audio":"video");if(k&&window.PluginRTC)return c.videosContainer.insertBefore(e,c.videosContainer.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(e,a),b(e)},1e3);if(e[f?"mozSrcObject":"src"]=f?a:window.URL.createObjectURL(a),e.controls=!0,f){var g="ended";"oninactive"in e&&(g="inactive"),e.addEventListener(g,function(){if(currentUserMediaRequest.remove(a.idInstance),"local"===a.type){g="ended","oninactive"in a&&(g="inactive"),P.onSyncNeeded(a.streamid,g),c.attachStreams.forEach(function(b,d){a.streamid===b.streamid&&delete c.attachStreams[d]});var b=[];c.attachStreams.forEach(function(a){a&&b.push(a)}),c.attachStreams=b;var d=c.streamEvents[a.streamid];if(d)return void c.onstreamended(d);this.parentNode&&this.parentNode.removeChild(this)}},!1)}e.play(),b(e)}function u(a,b){window.removeEventListener(a,b),window.addEventListener(a,b,!1)}function v(a){var b=[];return a.forEach(function(a){a&&b.push(a)}),b}function w(a){return!a.audio&&!a.video&&!a.screen&&a.data}function x(a){return void 0===a}function y(a){return"string"==typeof a}function A(a,b){return(!a.session.audio||"two-way"!==a.session.audio)&&(!(!f||!1===b)||!(!h||m<50)&&(!0===typeof b||!(void 0!==b||!a.session.audio||!a.session.screen||a.session.video)&&(b=!0,!0)))}function B(a){return!!f||!!h&&{mandatory:{chromeMediaSource:a.mandatory.chromeMediaSource,chromeMediaSourceId:a.mandatory.chromeMediaSourceId}}}function C(){if("iOS"===DetectRTC.osName&&"undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var a=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=a.RTCPeerConnection,window.RTCSessionDescription=a.RTCSessionDescription,window.RTCIceCandidate=a.RTCIceCandidate,window.MediaStream=a.MediaStream,window.MediaStreamTrack=a.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=a.getUserMedia,a.debug.enable("iosrtc*"),"function"==typeof a.selectAudioOutput&&a.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),a.registerGlobals()}}function E(a){var b;return b={mandatory:{OfferToReceiveAudio:!!a.OfferToReceiveAudio,OfferToReceiveVideo:!!a.OfferToReceiveVideo},optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&o>34&&(b={OfferToReceiveAudio:!!a.OfferToReceiveAudio,OfferToReceiveVideo:!!a.OfferToReceiveVideo}),b}function J(a){function j(){return e.getLocalStreams()}function q(b){b.binaryType="arraybuffer",b.onmessage=function(b){a.onDataChannelMessage(b.data)},b.onopen=function(){a.onDataChannelOpened(b)},b.onerror=function(b){a.onDataChannelError(b)},b.onclose=function(b){a.onDataChannelClosed(b)},b.internalSend=b.send,b.send=function(a){"open"===b.readyState&&b.internalSend(a)},e.channel=b}function s(d){e[d](function(d){d.sdp=b.processSdp(d.sdp),e.setLocalDescription(d,function(){b.trickleIce&&(a.onLocalSdp({type:d.type,sdp:d.sdp,remotePeerSdpConstraints:a.remotePeerSdpConstraints||!1,renegotiatingPeer:!!a.renegotiatingPeer||!1,connectionDescription:c.connectionDescription,dontGetRemoteStream:!!a.dontGetRemoteStream,extra:b?b.extra:{},streamsToShare:r,isFirefoxOffered:f}),b.onSettingLocalDescription(c))},function(a){b.enableLogs&&console.error("setLocalDescription error",a)})},function(a){b.enableLogs&&console.error("sdp-error",a)},D.sdpConstraints)}if(!F)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var b=a.rtcMultiConnection;this.extra=a.remoteSdp?a.remoteSdp.extra:b.extra,this.userid=a.userid,this.streams=[],this.channels=a.channels||[],this.connectionDescription=a.connectionDescription,this.addStream=function(a){b.addStream(a,this.userid)},this.removeStream=function(a){b.removeStream(a,this.userid)};var c=this;a.remoteSdp&&(this.connectionDescription=a.remoteSdp.connectionDescription);var d={};D.sdpConstraints=E({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var e,g=!!a.renegotiatingPeer;a.remoteSdp&&(g=!!a.remoteSdp.renegotiatingPeer);var h=[];if(b.attachStreams.forEach(function(a){a&&h.push(a)}),g)e=a.peerRef;else{var i="all";(b.candidates.turn||b.candidates.relay)&&(b.candidates.stun||b.candidates.reflexive||b.candidates.host||(i="relay")),e=new F(navigator.onLine?{iceServers:b.iceServers,iceTransportPolicy:b.iceTransportPolicy||i,rtcpMuxPolicy:b.rtcpMuxPolicy||"negotiate"}:null,window.PluginRTC?null:b.optionalArgument),b.iceServers.length||(e=new F(null,null))}e.onicecandidate=function(d){if(d.candidate)b.trickleIce&&a.onLocalCandidate({candidate:d.candidate.candidate,sdpMid:d.candidate.sdpMid,sdpMLineIndex:d.candidate.sdpMLineIndex});else if(!b.trickleIce){var g=e.localDescription;a.onLocalSdp({type:g.type,sdp:g.sdp,remotePeerSdpConstraints:a.remotePeerSdpConstraints||!1,renegotiatingPeer:!!a.renegotiatingPeer||!1,connectionDescription:c.connectionDescription,dontGetRemoteStream:!!a.dontGetRemoteStream,extra:b?b.extra:{},streamsToShare:r,isFirefoxOffered:f})}};a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.isFirefoxOffered,h.forEach(function(d){a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||a.dontAttachLocalStream||(d=b.beforeAddingStream(d,c))&&(j().forEach&&j().forEach(function(a){d&&a.id==d.id&&(d=null)}),d&&e.addStream(d))}),e.oniceconnectionstatechange=e.onsignalingstatechange=function(){var d=c.extra;b.peers[c.userid]&&(d=b.peers[c.userid].extra||d),e&&(a.onPeerStateChanged({iceConnectionState:e.iceConnectionState,iceGatheringState:e.iceGatheringState,signalingState:e.signalingState,extra:d,userid:c.userid}),e&&e.iceConnectionState&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&c.streams instanceof Array&&c.streams.forEach(function(a){var c=b.streamEvents[a.id]||{streamid:a.id,stream:a,type:"remote"};b.onstreamended(c)}))};var l={OfferToReceiveAudio:!!h.length,OfferToReceiveVideo:!!h.length};a.localPeerSdpConstraints&&(l=a.localPeerSdpConstraints),D.sdpConstraints=E(l);var n,m="addstream";e.addEventListener(m,function(c){if(c){if(c.streams&&c.streams.length&&!c.stream){if(!n)return void(n=new z);if(c.streams.forEach(function(a){a.getVideoTracks().length&&n.addTrack(a.getVideoTracks()[0]),a.getAudioTracks().length&&n.addTrack(a.getAudioTracks()[0])}),c.stream=n,b.session.audio&&b.session.video&&(!n.getVideoTracks().length||!n.getAudioTracks().length))return;n=null}var e={};a.remoteSdp&&a.remoteSdp.streamsToShare?e=a.remoteSdp.streamsToShare:a.streamsToShare&&(e=a.streamsToShare);var g=e[c.stream.id];g&&(c.stream.isAudio=g.isAudio,c.stream.isVideo=g.isVideo,c.stream.isScreen=g.isScreen),c.stream.streamid=c.stream.id,!f&&c.stream.stop||(c.stream.stop=function(){var a="ended";"oninactive"in c.stream&&(a="inactive"),p(c.stream,a)}),d[c.stream.id]=c.stream,a.onRemoteStream(c.stream)}},!1),e.onremovestream=function(b){b.stream.streamid=b.stream.id,d[b.stream.id]&&delete d[b.stream.id],a.onRemoteStreamRemoved(b.stream)},this.addRemoteCandidate=function(a){e.addIceCandidate(new H(a))},this.addRemoteSdp=function(a,c){a.sdp=b.processSdp(a.sdp),e.setRemoteDescription(new G(a),c||function(){},function(c){b.enableLogs&&console.error(JSON.stringify(c,null,"\t"),"\n",a.type,a.sdp)})};var o=!0;a.remoteSdp&&(o=!1),this.createDataChannel=function(){q(e.createDataChannel("sctp",{}))},!0!==b.session.data||g||(o?this.createDataChannel():e.ondatachannel=function(a){q(a.channel)}),a.remoteSdp&&(a.remoteSdp.remotePeerSdpConstraints&&(l=a.remoteSdp.remotePeerSdpConstraints),D.sdpConstraints=E(l),this.addRemoteSdp(a.remoteSdp,function(){s("createAnswer")})),"two-way"!=b.session.audio&&"two-way"!=b.session.video&&"two-way"!=b.session.screen||(D.sdpConstraints=E({OfferToReceiveAudio:"two-way"==b.session.audio||a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==b.session.video||"two-way"==b.session.screen||a.remoteSdp&&a.remoteSdp.remotePeerSdpConstraints&&a.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var r={};j().forEach&&j().forEach(function(a){r[a.streamid]={isAudio:!!a.isAudio,isVideo:!!a.isVideo,isScreen:!!a.isScreen}}),o&&s("createOffer"),e.nativeClose=e.close,e.close=function(){if(e){try{-1===e.iceConnectionState.search(/closed|failed/gi)&&e.getRemoteStreams().forEach(function(a){a.stop()}),e.nativeClose()}catch(a){}e=null,c.peer=null}},this.peer=e}function N(a,b){a.mandatory&&a.mandatory.chromeMediaSource?b.isScreen=!0:a.mozMediaSource||a.mediaSource?b.isScreen=!0:a.video?b.isVideo=!0:a.audio&&(b.isAudio=!0)}function O(a){function c(c,d){N(a.localMediaConstraints,c),a.onGettingLocalMedia(c,d);var e="ended";"oninactive"in c&&(e="inactive"),c.addEventListener(e,function(){delete currentUserMediaRequest.streams[b],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(a)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(a)],currentUserMediaRequest.queueRequests=v(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[b]={stream:c},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&O(currentUserMediaRequest.queueRequests.shift())}if(!0===currentUserMediaRequest.mutex)return void currentUserMediaRequest.queueRequests.push(a);currentUserMediaRequest.mutex=!0;var b=JSON.stringify(a.localMediaConstraints);if(currentUserMediaRequest.streams[b])c(currentUserMediaRequest.streams[b].stream,!0);else{if(k&&window.PluginRTC){document.createElement("video");return void window.PluginRTC.getUserMedia({audio:!0,video:!0},function(a){a.streamid=a.id||s(),c(a)},function(a){})}if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(a.localMediaConstraints,function(a){a.streamid=a.streamid||a.id||s(),a.idInstance=b,c(a)},function(b){a.onLocalMediaError(b,a.localMediaConstraints)});navigator.mediaDevices.getUserMedia(a.localMediaConstraints).then(function(a){a.streamid=a.streamid||a.id||s(),a.idInstance=b,c(a)}).catch(function(b){a.onLocalMediaError(b,a.localMediaConstraints)})}}function Q(a){if("PermissionDeniedError"==a){if(R="PermissionDeniedError",T)return T("PermissionDeniedError");throw new Error("PermissionDeniedError: User rejected to share his screen.")}"rtcmulticonnection-extension-loaded"==a&&(R="desktop"),a.sourceId&&T&&(S=a.sourceId,T(S))}function U(a){if(a){if(f)return V(a);if(window.IsAndroidChrome)return R="screen",void a(!0);if("desktop"==R)return void a(!0);window.postMessage("are-you-there","*"),setTimeout(function(){a("screen"==R?!1:!0)},2e3)}}function V(a){function c(d){var e=d.data;e&&void 0!==e.isScreenCapturingEnabled&&(b=!0,a(!0===e.isScreenCapturingEnabled?!0:!1),window.removeEventListener("message",c,!1))}if(a){if(!f)return U(a);var b=!1;window.addEventListener("message",c,!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){b||a(!0)},2e3)}}function W(a,b){if(!a)throw'"callback" parameter is mandatory.';return S?(a(S),void(S=null)):(T=a,b?void window.postMessage("audio-plus-tab","*"):void window.postMessage("get-sourceId","*"))}function X(a,b){if(window.IsAndroidChrome)return R="screen",void b("installed-enabled");if(2!=arguments.length&&(b=a,a=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),f)return b("not-chrome");var c=document.createElement("img");c.src="chrome-extension://"+a+"/icon.png",c.onload=function(){S=null,R="screen",window.postMessage("are-you-there","*"),setTimeout(function(){b("screen"==R?a==a?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},c.onerror=function(){b("not-installed")}}function Y(a,b){var c={mozMediaSource:"window",mediaSource:"window",width:29999,height:8640};if(f)return a(null,c);S=null,U(function(c){var d={mandatory:{chromeMediaSource:R,maxWidth:29999,maxHeight:8640,minFrameRate:30,maxFrameRate:128,minAspectRatio:1.77},optional:[]};return window.IsAndroidChrome?void a(null,d):"desktop"!=R||S?("desktop"==R&&(d.mandatory.chromeMediaSourceId=S),S=null,R="screen",T=null,void a(null,d)):void W(function(){d.mandatory.chromeMediaSourceId=S,a("PermissionDeniedError"==S?S:null,d),S=null},b)})}function Z(a){function c(c,d,e){var f=c.uuid;if(b[f]||(b[f]=[]),b[f].push(c.message),c.last){var g=b[f].join("");c.isobject&&(g=JSON.parse(g));var h=(new Date).getTime(),i=h-c.sendingTime,j={data:g,userid:d,extra:e,latency:i};a.autoTranslateText?(j.original=j.data,a.Translator.TranslateText(j.data,function(b){j.data=b,a.onmessage(j)})):a.onmessage(j),delete b[f]}}var b={};return{receive:c}}var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,f=void 0!==window.InstallTrigger,g=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h=!!window.chrome&&!e,i=!!document.documentMode,j=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);"undefined"!=typeof cordova&&(j=!0,h=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(j=!0,h=!0);var k=!j&&(g||i);k&&"undefined"!=typeof URL&&(URL.createObjectURL=function(){});var m=(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"],50),n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);h&&n&&n[2]&&(m=parseInt(n[2],10));var o=50;n=navigator.userAgent.match(/Firefox\/(.*)/),f&&n&&n[1]&&(o=parseInt(n[1],10)),window.addEventListener||(window.addEventListener=function(a,b,c){a.attachEvent&&a.attachEvent("on"+b,c)}),window.attachEventListener=function(a,b,c,d){a.addEventListener(b,c,d)};var z=window.MediaStream;void 0===z&&"undefined"!=typeof webkitMediaStream&&(z=webkitMediaStream),void 0!==z&&("getVideoTracks"in z.prototype||(z.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("video")&&a.push(b)}),a},z.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("audio")&&a.push(b)}),a}),"stop"in z.prototype||(z.prototype.stop=function(){this.getAudioTracks().forEach(function(a){a.stop&&a.stop()}),this.getVideoTracks().forEach(function(a){a.stop&&a.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",function(){"use strict";function l(){var m,n,o,b=(d.appVersion,d.userAgent),c=d.appName,e=""+parseFloat(d.appVersion),l=parseInt(d.appVersion,10);if(g){c="Opera";try{e=d.userAgent.split("OPR/")[1].split(" ")[0],l=e.split(".")[0]}catch(a){e="0.0.0.0",l=0}}else k?(n=b.indexOf("MSIE"),c="IE",e=b.substring(n+5)):j?(n=b.indexOf("Chrome"),c="Chrome",e=b.substring(n+7)):i?(n=b.indexOf("Safari"),c="Safari",e=b.substring(n+7),-1!==(n=b.indexOf("Version"))&&(e=b.substring(n+8))):h?(n=b.indexOf("Firefox"),c="Firefox",e=b.substring(n+8)):(m=b.lastIndexOf(" ")+1)<(n=b.lastIndexOf("/"))&&(c=b.substring(m,n),e=b.substring(n+1),c.toLowerCase()===c.toUpperCase()&&(c=d.appName));return f&&(c="Edge",e=parseInt(d.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),-1!==(o=e.indexOf(";"))&&(e=e.substring(0,o)),-1!==(o=e.indexOf(" "))&&(e=e.substring(0,o)),l=parseInt(""+e,10),isNaN(l)&&(e=""+parseFloat(d.appVersion),l=parseInt(d.appVersion,10)),{fullVersion:e,version:l,name:c,isPrivateBrowsing:!1}}function m(a,b){var c=0,d=50,f=!1,g=window.setInterval(function(){a()&&(window.clearInterval(g),b(f)),c++>d&&(window.clearInterval(g),f=!0,b(f))},10)}function n(a){var b=a.toLowerCase();if(0===b.indexOf("msie")&&0===b.indexOf("trident"))return!1;var c=/(?:msie|rv:)\s?([\d\.]+)/.exec(b);return!!(c&&parseInt(c[1],10)>=10)}function o(a){var b;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){b=!1},function(a){b=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var c;try{c=window.indexedDB.open("test"),c.onerror=function(){return!0}}catch(a){b=!0}void 0===b&&m(function(){return"done"===c.readyState},function(d){d||(b=!c.result)})}else if(n(window.navigator.userAgent)){b=!1;try{window.indexedDB||(b=!0)}catch(a){b=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(a){b=!0}void 0===b&&(b=!1,window.localStorage.removeItem("test"))}}catch(a){b=!1}m(function(){return void 0!==b},function(d){a(b)})}function q(){var a="-",b=d.appVersion,c=d.userAgent,e=a,f=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var g in f){var h=f[g];if(h.r.test(c)){e=h.s;break}}var i=a;switch(/Windows/.test(e)&&(/Windows (.*)/.test(e)&&(i=/Windows (.*)/.exec(e)[1]),e="Windows"),e){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(c)&&(i=/Mac OS X (10[\.\_\d]+)/.exec(c)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(c)&&(i=/Android ([\.\_\d]+)/.exec(c)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(c)&&(i=/OS (\d+)_(\d+)_?(\d+)?/.exec(b),i=i[1]+"."+i[2]+"."+(0|i[3]))}return{osName:e,osVersion:i}}function t(a){a=(a||d.userAgent).toLowerCase();var b=a.match(/android\s([0-9\.]*)/);return!!b&&b[1]}function x(a){L.isWebRTCSupported&&(L.isORTCSupported||y(function(b){a(b.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+b:"Public: "+b)}))}function y(a){function j(c){var d=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,e=d.exec(c);if(!e)return void console.warn("Could not match IP address in",c);var f=e[1];void 0===b[f]&&a(f),b[f]=!0}var b={},c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,d=!!window.webkitRTCPeerConnection;if(!c){var e=document.getElementById("iframe");if(!e)throw"NOTE: you need to have an iframe in the page right above the script tag.";var f=e.contentWindow;c=f.RTCPeerConnection||f.mozRTCPeerConnection||f.webkitRTCPeerConnection,d=!!f.webkitRTCPeerConnection}if(c){var h,g={optional:[{RtpDataChannels:!0}]};d&&(h={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},void 0!==L&&L.browser.isFirefox&&L.browser.version<=38&&(h[0]={url:h[0].urls}));var i=new c(h,g);i.onicecandidate=function(a){a.candidate&&j(a.candidate.candidate)},i.createDataChannel(""),i.createOffer(function(a){i.setLocalDescription(a,function(){},function(){})},function(){}),setTimeout(function(){i.localDescription.sdp.split("\n").forEach(function(a){0===a.indexOf("a=candidate:")&&j(a)})},1e3)}}function K(a){if(!D)return void(a&&a());if(!d.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(d.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!d.enumerateDevices&&d.enumerateDevices&&(d.enumerateDevices=d.enumerateDevices.bind(d)),!d.enumerateDevices)return void(a&&a());z=[],A=[],B=[],C=[],H=!1,J=!1;var b={};d.enumerateDevices(function(c){c.forEach(function(a){var c={};for(var d in a)try{"function"!=typeof a[d]&&(c[d]=a[d])}catch(a){}b[c.deviceId+c.label]||("audio"===c.kind&&(c.kind="audioinput"),"video"===c.kind&&(c.kind="videoinput"),c.deviceId||(c.deviceId=c.id),c.id||(c.id=c.deviceId),c.label?("videoinput"!==c.kind||J||(J=!0),"audioinput"!==c.kind||H||(H=!0)):(c.label="Please invoke getUserMedia once.",L.browser.isChrome&&L.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(c.label="HTTPs is required to get label of this "+c.kind+" device.")),"audioinput"===c.kind&&(E=!0,-1===A.indexOf(c)&&A.push(c)),"audiooutput"===c.kind&&(F=!0,-1===B.indexOf(c)&&B.push(c)),"videoinput"===c.kind&&(G=!0,-1===C.indexOf(c)&&C.push(c)),z.push(c),b[c.deviceId+c.label]=c)}),void 0!==L&&(L.MediaDevices=z,L.hasMicrophone=E,L.hasSpeakers=F,L.hasWebcam=G,L.isWebsiteHasWebcamPermissions=J,L.isWebsiteHasMicrophonePermissions=H,L.audioInputDevices=A,L.audioOutputDevices=B,L.videoInputDevices=C),a&&a()})}var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",b="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;if(b){var c=process.versions.node.toString().replace("v","");a="Nodejs/"+c+" (NodeOS) AppleWebKit/"+c+" (KHTML, like Gecko) Nodejs/"+c+" Nodejs/"+c}!function(b){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:a,getUserMedia:function(){}},b.window=global),"undefined"==typeof document&&(b.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(b.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(b.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var d=window.navigator;void 0!==d?(void 0!==d.webkitGetUserMedia&&(d.getUserMedia=d.webkitGetUserMedia),void 0!==d.mozGetUserMedia&&(d.getUserMedia=d.mozGetUserMedia)):d={getUserMedia:function(){},userAgent:a};var e=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(d.userAgent||""),f=!(-1===d.userAgent.indexOf("Edge")||!d.msSaveOrOpenBlob&&!d.msSaveBlob),g=!!window.opera||d.userAgent.indexOf(" OPR/")>=0,h=void 0!==window.InstallTrigger,i=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,j=!!window.chrome&&!g,k=!!document.documentMode&&!f,p={Android:function(){return d.userAgent.match(/Android/i)},BlackBerry:function(){return d.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return d.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return d.userAgent.match(/Opera Mini/i)},Windows:function(){return d.userAgent.match(/IEMobile/i)},any:function(){return p.Android()||p.BlackBerry()||p.iOS()||p.Opera()||p.Windows()},getOsName:function(){var a="Unknown OS";return p.Android()&&(a="Android"),p.BlackBerry()&&(a="BlackBerry"),p.iOS()&&(a="iOS"),p.Opera()&&(a="Opera Mini"),p.Windows()&&(a="Windows"),a}},r="Unknown OS",s="Unknown OS Version",u=q();u&&u.osName&&"-"!=u.osName?(r=u.osName,s=u.osVersion):p.any()&&"Android"==(r=p.getOsName())&&(s=t());var b="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===r&&b&&(r="Nodejs",s=process.versions.node.toString().replace("v",""));var v=!1,w=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(a){!v&&a in document.createElement("canvas")&&(v=!0),!w&&a in document.createElement("video")&&(w=!0)});var z=[],A=[],B=[],C=[];d.mediaDevices&&d.mediaDevices.enumerateDevices&&(d.enumerateDevices=function(a){d.mediaDevices.enumerateDevices().then(a).catch(function(){a([])})});var D=!1;void 0!==I&&"getSources"in I?D=!0:d.mediaDevices&&d.mediaDevices.enumerateDevices&&(D=!0);var E=!1,F=!1,G=!1,H=!1,J=!1;K();var L=window.DetectRTC||{};L.browser=l(),o(function(a){L.browser.isPrivateBrowsing=!!a}),L.browser["is"+L.browser.name]=!0,L.osName=r,L.osVersion=s;var N=("object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(a){N||a in window&&(N=!0)}),L.isWebRTCSupported=N,L.isORTCSupported="undefined"!=typeof RTCIceGatherer;var O=!1;L.browser.isChrome&&L.browser.version>=35?O=!0:L.browser.isFirefox&&L.browser.version>=34&&(O=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||"")||(document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(O=!1),L.browser.isFirefox&&(O=!1)),L.isScreenCapturingSupported=O;var P={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(a){P.isSupported||a in window&&(P.isSupported=!0,window[a]&&"createMediaStreamSource"in window[a].prototype&&(P.isCreateMediaStreamSourceSupported=!0))}),L.isAudioContextSupported=P.isSupported,L.isCreateMediaStreamSourceSupported=P.isCreateMediaStreamSourceSupported;var Q=!1;L.browser.isChrome&&L.browser.version>31&&(Q=!0),L.isRtpDataChannelsSupported=Q;var R=!1;L.browser.isFirefox&&L.browser.version>28?R=!0:L.browser.isChrome&&L.browser.version>25?R=!0:L.browser.isOpera&&L.browser.version>=11&&(R=!0),L.isSctpDataChannelsSupported=R,L.isMobileDevice=e;var S=!1;d.getUserMedia?S=!0:d.mediaDevices&&d.mediaDevices.getUserMedia&&(S=!0),L.browser.isChrome&&L.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(S="Requires HTTPs"),"Nodejs"===L.osName&&(S=!1),L.isGetUserMediaSupported=S;var T="";if(screen.width){T+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")}L.displayResolution=T,L.isCanvasSupportsStreamCapturing=v,L.isVideoSupportsStreamCapturing=w,"Chrome"==L.browser.name&&L.browser.version>=53&&(L.isCanvasSupportsStreamCapturing||(L.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),L.isVideoSupportsStreamCapturing||(L.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),L.DetectLocalIPAddress=x,L.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,L.isWebSocketsBlocked=!L.isWebSocketsSupported,"Nodejs"===L.osName&&(L.isWebSocketsSupported=!0,L.isWebSocketsBlocked=!1),L.checkWebSocketsSupport=function(a){a=a||function(){};try{var b=new WebSocket("wss://echo.websocket.org:443/");b.onopen=function(){L.isWebSocketsBlocked=!1,a(),b.close(),b=null},b.onerror=function(){L.isWebSocketsBlocked=!0,a()}}catch(b){L.isWebSocketsBlocked=!0,a()}},L.load=function(a){a=a||function(){},K(a)},L.MediaDevices=z,L.hasMicrophone=E,L.hasSpeakers=F,L.hasWebcam=G,L.isWebsiteHasWebcamPermissions=J,L.isWebsiteHasMicrophonePermissions=H,L.audioInputDevices=A,L.audioOutputDevices=B,L.videoInputDevices=C;var W=!1;"setSinkId"in document.createElement("video")&&(W=!0),L.isSetSinkIdSupported=W;var X=!1;L.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(X=!0):L.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(X=!0),L.isRTPSenderReplaceTracksSupported=X;var Y=!1;L.browser.isFirefox&&L.browser.version>38&&(Y=!0),L.isRemoteStreamProcessingSupported=Y;var Z=!1;void 0!==I&&"applyConstraints"in I.prototype&&(Z=!0),L.isApplyConstraintsSupported=Z;var $=!1;L.browser.isFirefox&&L.browser.version>=43&&($=!0),L.isMultiMonitorScreenCapturingSupported=$,L.isPromisesSupported=!!("Promise"in window),void 0===L&&(window.DetectRTC={});var _=window.MediaStream;void 0===_&&"undefined"!=typeof webkitMediaStream&&(_=webkitMediaStream),L.MediaStream=void 0!==_&&Object.keys(_.prototype),L.MediaStreamTrack=void 0!==I&&Object.keys(I.prototype);var aa=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;L.RTCPeerConnection=void 0!==aa&&Object.keys(aa.prototype),window.DetectRTC=L,"undefined"!=typeof module&&(module.exports=L),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return L})}(),document.addEventListener("deviceready",C,!1),C();var F,D={};void 0!==window.RTCPeerConnection?F=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?F=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(F=webkitRTCPeerConnection);var G=window.RTCSessionDescription||window.mozRTCSessionDescription,H=window.RTCIceCandidate||window.mozRTCIceCandidate,I=window.MediaStreamTrack;window.onPluginRTCInitialized=function(){I=window.PluginRTC.MediaStreamTrack,F=window.PluginRTC.RTCPeerConnection,H=window.PluginRTC.RTCIceCandidate,G=window.PluginRTC.RTCSessionDescription},void 0!==window.PluginRTC&&window.onPluginRTCInitialized();var K=function(){function b(a){if(!a||"string"!=typeof a)throw"Invalid arguments.";return a=a.replace("a=rtpmap:100 VP8/90000\r\n",""),a=a.replace("a=rtpmap:101 VP9/90000\r\n",""),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),a=a.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),a=a.replace("a=rtcp-fb:120 nack\r\n",""),a=a.replace("a=rtcp-fb:120 nack pli\r\n",""),a=a.replace("a=rtcp-fb:120 ccm fir\r\n",""),a=a.replace("a=rtcp-fb:101 nack\r\n",""),a=a.replace("a=rtcp-fb:101 nack pli\r\n",""),a=a.replace("a=rtcp-fb:101 ccm fir\r\n","")}function c(a){if(!a||"string"!=typeof a)throw"Invalid arguments.";return a=a.replace("a=rtcp-fb:126 nack\r\n",""),a=a.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),a=a.replace("a=rtcp-fb:97 nack\r\n",""),a=a.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")}function d(a,b){if(b&&b.getSenders&&b.getSenders().length){if(!a||"string"!=typeof a)throw"Invalid arguments.";b.getSenders().forEach(function(b){for(var c=b.getParameters(),d=0;d<c.codecs.length;d++)if(c.codecs[d].mimeType==a){c.codecs.unshift(c.codecs.splice(d,1));break}b.setParameters(c)})}}function e(a){return a.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function g(b,c,d){return c?void 0!==f&&f?b:a?b:(d&&(c.screen?c.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),c.screen&&d&&(b=b.replace(/b=AS([^\r\n]+\r\n)/g,""),b=b.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+c.screen+"\r\n")),(c.audio||c.video||c.data)&&(b=b.replace(/b=AS([^\r\n]+\r\n)/g,"")),c.audio&&(b=b.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+c.audio+"\r\n")),c.video&&(b=b.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(d?c.screen:c.video)+"\r\n")),b):b}function h(a,b,c){return i(a,0,-1,b,c)}function i(a,b,c,d,e){for(var f=-1!==c?c:a.length,g=b;g<f;++g)if(0===a[g].indexOf(d)&&(!e||-1!==a[g].toLowerCase().indexOf(e.toLowerCase())))return g;return null}function j(a){var b=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),c=a.match(b);return c&&2===c.length?c[1]:null}function k(b,c){if(a)return b;c=c||{};var i,d=c.min,e=c.max,f=b.split("\r\n"),g=h(f,"a=rtpmap","VP8/90000");if(g&&(i=j(f[g])),!i)return b;var l,k=h(f,"a=rtpmap","rtx/90000");if(k&&(l=j(f[k])),!k)return b;var m=h(f,"a=fmtp:"+l.toString());if(null!==m){var n="\r\n";n+="a=fmtp:"+i+" x-google-min-bitrate="+(d||"228")+"; x-google-max-bitrate="+(e||"228"),f[m]=f[m].concat(n),b=f.join("\r\n")}return b}function l(b,c){if(a)return b;c=c||{};var f,d=b.split("\r\n"),e=h(d,"a=rtpmap","opus/48000");if(e&&(f=j(d[e])),!f)return b;var g=h(d,"a=fmtp:"+f.toString());if(null===g)return b;var i="";return i+="; stereo="+(void 0!==c.stereo?c.stereo:"1"),i+="; sprop-stereo="+(void 0!==c["sprop-stereo"]?c["sprop-stereo"]:"1"),void 0!==c.maxaveragebitrate&&(i+="; maxaveragebitrate="+(c.maxaveragebitrate||1048576)),void 0!==c.maxplaybackrate&&(i+="; maxplaybackrate="+(c.maxplaybackrate||1048576)),void 0!==c.cbr&&(i+="; cbr="+(void 0!==c.cbr?c.cbr:"1")),void 0!==c.useinbandfec&&(i+="; useinbandfec="+c.useinbandfec),void 0!==c.usedtx&&(i+="; usedtx="+c.usedtx),void 0!==c.maxptime&&(i+="\r\na=maxptime:"+c.maxptime),d[g]=d[g].concat(i),b=d.join("\r\n")}function m(a){return-1===a.indexOf("SAVPF 100 101")||-1===a.indexOf("VP9/90000")?a:a.replace("SAVPF 100 101","SAVPF 101 100")}function n(a){for(var b=a.split("\r\n"),c=null,d=0;d<b.length;d++)if(-1!==b[d].search("opus/48000")){var e=extractSdp(b[d],/:(\d+) opus\/48000/i);break}for(var d=0;d<b.length;d++)if(-1!==b[d].search("a=fmtp")){var f=extractSdp(b[d],/a=fmtp:(\d+)/);if(f===e){c=d;break}}return null===c?a:(b[c]=b[c].concat("; stereo=1; sprop-stereo=1"),a=b.join("\r\n"))}var a=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(a=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(a=!0),{removeVPX:b,disableNACK:c,prioritize:d,removeNonG722:e,setApplicationSpecificBandwidth:function(a,b,c){return g(a,b,c)},setVideoBitrates:function(a,b){return k(a,b)},setOpusAttributes:function(a,b){return l(a,b)},preferVP9:m,forceStereoAudio:n}}();window.BandwidthHandler=K;var L=function(){function a(a,b){var c=b.candidate,d=a.candidates,e=d.stun,f=d.turn;if(x(d.reflexive)||(e=d.reflexive),x(d.relay)||(f=d.relay),(d.host||!c.match(/typ host/g))&&(f||!c.match(/typ relay/g))&&(e||!c.match(/typ srflx/g))){var g=a.iceProtocols;if((g.udp||!c.match(/ udp /g))&&(g.tcp||!c.match(/ tcp /g)))return a.enableLogs,{candidate:c,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}}}return{processCandidates:a}}(),M=function(){function a(a){var d=[];return d.push(b("stun:stun.l.google.com:19302")),d.push(c("stun:webrtcweb.com:7788","muazkh","muazkh")),d.push(c("turn:webrtcweb.com:7788","muazkh","muazkh")),d.push(c("turn:webrtcweb.com:8877","muazkh","muazkh")),d.push(c("turns:webrtcweb.com:7788","muazkh","muazkh")),d.push(c("turns:webrtcweb.com:8877","muazkh","muazkh")),d.push(c("stun:webrtcweb.com:4455","muazkh","muazkh")),d.push(c("turn:webrtcweb.com:4455","muazkh","muazkh")),d.push(c("turn:webrtcweb.com:5544?transport=tcp","muazkh","muazkh")),d}function b(a){var b="urls";void 0!==k&&(b="url");var c={};return c[b]=a,c}function c(a,b,c){var d="urls";void 0!==k&&(d="url");var e={username:b,credential:c};return e[d]=a,e}return{getIceServers:a}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(a){this.mutex=!1;var b=this.streams[a];if(b){b=b.stream;var c=b.currentUserMediaRequestOptions;this.queueRequests.indexOf(c)&&(delete this.queueRequests[this.queueRequests.indexOf(c)],this.queueRequests=v(this.queueRequests)),this.streams[a].stream=null,delete this.streams[a]}}};var P=function(){function a(a){if(a)return"string"==typeof a||void 0===a?a:a.audio&&a.video?null:a.audio?"audio":a.video?"video":void 0}function b(b,d,e){function g(){if(e.streamEvents[b.streamid].mediaElement){var a=e.streamEvents[b.streamid].mediaElement;a.volume=0,c(200,5,function(){try{a.volume+=.2}catch(b){a.volume=1}})}}if(b&&b.addEventListener){if(void 0===d||1==d){var f="ended";"oninactive"in b&&(f="inactive"),b.addEventListener(f,function(){P.onSyncNeeded(this.streamid,f)},!1)}b.mute=function(c,f){c=a(c),void 0!==f&&(d=f),void 0!==c&&"audio"!=c||b.getAudioTracks().forEach(function(a){a.enabled=!1,e.streamEvents[b.streamid].isAudioMuted=!0}),void 0!==c&&"video"!=c||b.getVideoTracks().forEach(function(a){a.enabled=!1}),void 0!==d&&1!=d||P.onSyncNeeded(b.streamid,"mute",c),e.streamEvents[b.streamid].muteType=c||"both",p(b,"mute",c)},b.unmute=function(c,f){c=a(c),void 0!==f&&(d=f),g(),void 0!==c&&"audio"!=c||b.getAudioTracks().forEach(function(a){a.enabled=!0,e.streamEvents[b.streamid].isAudioMuted=!1}),void 0!==c&&"video"!=c||(b.getVideoTracks().forEach(function(a){a.enabled=!0}),void 0!==c&&"video"==c&&e.streamEvents[b.streamid].isAudioMuted&&function a(c){c||(c=0),++c<100&&e.streamEvents[b.streamid].isAudioMuted&&(b.mute("audio"),setTimeout(function(){a(c)},50))}()),void 0!==d&&1!=d||P.onSyncNeeded(b.streamid,"unmute",c),e.streamEvents[b.streamid].unmuteType=c||"both",p(b,"unmute",c)}}}function c(a,b,d,e){(e=(e||0)+1)>=b||setTimeout(function(){d(),c(a,b,d,e)},a)}return{setHandlers:b,onSyncNeeded:function(a,b,c){}}}();window.addEventListener("message",function(a){a.origin==window.location.origin&&Q(a.data)}),window.IsAndroidChrome=!1;try{navigator.userAgent.toLowerCase().indexOf("android")>-1&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&(window.IsAndroidChrome=!0)}catch(a){}var S,T,R="screen",$={send:function(a){function k(a,e){var l={type:"text",uuid:i,sendingTime:j};a&&(e=a,l.packets=parseInt(e.length/f)),e.length>f?l.message=e.slice(0,f):(l.message=e,l.last=!0,l.isobject=h),c.send(l,d),g=e.slice(l.message.length),g.length&&setTimeout(function(){k(null,g)},b.chunkInterval||100)}var b=a.connection,c=a.channel,d=a.remoteUserId,e=a.text,f=b.chunkSize||1e3,g="",h=!1;y(e)||(h=!0,e=JSON.stringify(e));var i=s(),j=(new Date).getTime();k(e)}},_=function(){function a(a){function c(a,b){if(-1!==a.position){var c=+a.position.toFixed(2).split(".")[1]||100;b.innerHTML=c+"%"}}var b={};a.onFileStart=function(c){var d=document.createElement("div");if(d.title=c.name,d.innerHTML="<label>0%</label> <progress></progress>",c.remoteUserId&&(d.innerHTML+=" (Sharing with:"+c.remoteUserId+")"),a.filesContainer||(a.filesContainer=document.body||document.documentElement),a.filesContainer.insertBefore(d,a.filesContainer.firstChild),!c.remoteUserId)return b[c.uuid]={div:d,progress:d.querySelector("progress"),label:d.querySelector("label")},void(b[c.uuid].progress.max=c.maxChunks);b[c.uuid]||(b[c.uuid]={}),b[c.uuid][c.remoteUserId]={div:d,progress:d.querySelector("progress"),label:d.querySelector("label")},b[c.uuid][c.remoteUserId].progress.max=c.maxChunks},a.onFileProgress=function(a){var d=b[a.uuid];d&&(a.remoteUserId&&!(d=b[a.uuid][a.remoteUserId])||(d.progress.value=a.currentPosition||a.maxChunks||d.progress.max,c(d.progress,d.label)))},a.onFileEnd=function(a){var c=b[a.uuid];if(!c)return void console.error("No such progress-helper element exist.",a);if(!a.remoteUserId||(c=b[a.uuid][a.remoteUserId])){var d=c.div;-1!=a.type.indexOf("image")?d.innerHTML='<a href="'+a.url+'" download="'+a.name+'">Download <strong style="color:red;">'+a.name+'</strong> </a><br /><img src="'+a.url+'" title="'+a.name+'" style="max-width: 80%;">':d.innerHTML='<a href="'+a.url+'" download="'+a.name+'">Download <strong style="color:red;">'+a.name+'</strong> </a><br /><iframe src="'+a.url+'" title="'+a.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}return{handle:a}}(),aa=function(){function a(a){a.autoTranslateText=!1,a.language="en",a.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",a.Translator={TranslateText:function(b,c){var d=document.createElement("script");d.type="text/javascript";var e=encodeURIComponent(b),f="method"+a.token();window[f]=function(a){return a.data&&a.data.translations[0]&&c?void c(a.data.translations[0].translatedText):a.error&&"Daily Limit Exceeded"===a.error.message?void console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):a.error?void console.error(a.error.message):void console.error(a)};var g="https://www.googleapis.com/language/translate/v2?key="+a.googKey+"&target="+(a.language||"en-US")+"&callback=window."+f+"&q="+e;d.src=g,document.getElementsByTagName("head")[0].appendChild(d)},getListOfLanguages:function(b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState==XMLHttpRequest.DONE){var a=JSON.parse(c.responseText);if(a&&a.data&&a.data.languages)return void b(a.data.languages);if(a.error&&"Daily Limit Exceeded"===a.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(a.error)return void console.error(a.error.message);console.error(a)}};var d="https://www.googleapis.com/language/translate/v2/languages?key="+a.googKey+"&target=en";c.open("GET",d,!0),c.send(null)}}}return{handle:a}}();!function(e){function i(a){e.deletePeer(a)}function k(a){if(e.socketAutoReConnect=!0,e.socket)return void(a&&a(e.socket));if(void 0===c)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new c(e,function(b){a&&a(e.socket)})}function l(a,b){if(e.dontCaptureUserMedia||a.isDataOnly)return void b();var c={};a.localPeerSdpConstraints.OfferToReceiveAudio&&(c.audio=e.mediaConstraints.audio),a.localPeerSdpConstraints.OfferToReceiveVideo&&(c.video=e.mediaConstraints.video);var d=a.session||e.session;if(d.oneway&&"two-way"!==d.audio&&"two-way"!==d.video&&"two-way"!==d.screen)return void b();d.oneway&&d.audio&&"two-way"===d.audio&&(d={audio:!0}),(d.audio||d.video||d.screen)&&(d.screen?e.getScreenConstraints(function(a,c){e.invokeGetUserMedia({audio:!!A(e)&&B(c),video:c,isScreen:!0},!d.audio&&!d.video||A(e)?b:e.invokeGetUserMedia(null,b))}):(d.audio||d.video)&&e.invokeGetUserMedia(null,b,d))}function m(a,b){e.closeBeforeUnload&&(!0===e.isInitiator&&e.dontMakeMeModerator(),e.peers.getAllParticipants().forEach(function(a){g.onNegotiationNeeded({userLeft:!0},a),e.peers[a]&&e.peers[a].peer&&e.peers[a].peer.close(),delete e.peers[a]}),b||e.closeSocket(),e.broadcasters=[],e.isInitiator=!1)}function n(a,b){if(!a)return void(e.enableLogs&&console.error("No stream to applyConstraints."));b.audio&&a.getAudioTracks().forEach(function(a){a.applyConstraints(b.audio)}),b.video&&a.getVideoTracks().forEach(function(a){a.applyConstraints(b.video)})}function o(a,b,c){if(b)return void g.replaceTrack(a,b,c);e.peers.getAllParticipants().forEach(function(b){g.replaceTrack(a,b,c)})}function p(){if(e.isInitiator&&!e.session.oneway&&!e.session.broadcast&&"many-to-many"===e.direction){var a=e.broadcasters[0],b=[];e.broadcasters.forEach(function(c){c!==a&&b.push(c)}),e.autoCloseEntireSession||e.shiftModerationControl(a,b,!0)}}b=b||{useDefaultDevices:!0},e.channel=e.sessionid=(a||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var g=new d(e),h={};g.onGettingLocalMedia=function(a){if(!h[a.streamid]){h[a.streamid]=!0;try{a.type="local"}catch(a){}e.setStreamEndHandler(a),t(a,function(b){b.id=a.streamid,b.muted=!0,b.volume=0,-1===e.attachStreams.indexOf(a)&&e.attachStreams.push(a),void 0!==P&&P.setHandlers(a,!0,e),e.streamEvents[a.streamid]={socketID:e.socket.id,stream:a,type:"local",mediaElement:b,userid:e.userid,extra:e.extra,streamid:a.streamid,blobURL:b.src||URL.createObjectURL(a),isAudioMuted:!0},q(e,e.streamEvents[a.streamid]),r(e,e.streamEvents[a.streamid]),e.onstream(e.streamEvents[a.streamid])},e)}},g.onGettingRemoteMedia=function(a,b){try{a.type="remote"}catch(a){}e.setStreamEndHandler(a,"remote-stream"),t(a,function(c){c.id=a.streamid,void 0!==P&&P.setHandlers(a,!1,e),e.streamEvents[a.streamid]={socketID:e.socket.id,stream:a,type:"remote",userid:b,extra:e.peers[b]?e.peers[b].extra:{},mediaElement:c,streamid:a.streamid,blobURL:c.src||URL.createObjectURL(a)},r(e,e.streamEvents[a.streamid]),e.onstream(e.streamEvents[a.streamid])},e)},g.onRemovingRemoteMedia=function(a,b){var c=e.streamEvents[a.streamid];c||(c={stream:a,type:"remote",userid:b,extra:e.peers[b]?e.peers[b].extra:{},streamid:a.streamid,mediaElement:e.streamEvents[a.streamid]?e.streamEvents[a.streamid].mediaElement:null}),e.peersBackup[c.userid]&&(c.extra=e.peersBackup[c.userid].extra),e.onstreamended(c),delete e.streamEvents[a.streamid]},g.onNegotiationNeeded=function(a,b,c){k(function(){e.socket.emit(e.socketMessageEvent,"password"in a?a:{remoteUserId:a.remoteUserId||b,message:a,sender:e.userid},c||function(){})})},g.onUserLeft=i,g.disconnectWith=function(a,b){e.socket&&e.socket.emit("disconnect-with",a,b||function(){}),e.deletePeer(a)},e.broadcasters=[],e.socketOptions={transport:"polling"},e.openOrJoin=function(a,b){e.checkPresence(a,function(c,d){if("function"==typeof b&&(b(c,d),b=null),c){e.sessionid=d;var f=!1,h=!1,i=!!e.session.oneway,j=w(e.session);h={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},f={OfferToReceiveAudio:i?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo};var k={remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:j,localPeerSdpConstraints:f,remotePeerSdpConstraints:h},sender:e.userid,password:b||!1};return void l(k.message,function(){g.onNegotiationNeeded(k)})}e.userid;e.userid=e.sessionid=a||e.sessionid,e.userid+="",e.socket.emit("changed-uuid",e.userid),b&&e.socket.emit("set-password",b),e.isInitiator=!0,w(e.session)||e.captureUserMedia()})},e.open=function(b,c,d){e.userid;if(e.userid=e.sessionid=b||e.sessionid,e.userid+="",e.isInitiator=!0,k(function(){e.socket.emit("changed-uuid",e.userid),1==c&&e.becomePublicModerator(d,a)}),w(e.session))return void("function"==typeof c&&c());e.captureUserMedia("function"==typeof c?c:null)},e.becomePublicModerator=(b=>{if(!e.isInitiator)return;e.socket.emit("become-a-public-moderator",b,a)}),e.dontMakeMeModerator=function(a){e.socket.emit("dont-make-me-moderator")},e.deletePeer=function(a){if(a){var b={userid:a,extra:e.peers[a]?e.peers[a].extra:{}};if(e.peersBackup[b.userid]&&(b.extra=e.peersBackup[b.userid].extra),e.onleave(b),e.peers[a]){e.peers[a].streams.forEach(function(a){a.stop()});var c=e.peers[a].peer;if(c&&"closed"!==c.iceConnectionState)try{c.close()}catch(a){}e.peers[a]&&(e.peers[a].peer=null,delete e.peers[a])}if(-1!==e.broadcasters.indexOf(a)){var d=[];e.broadcasters.forEach(function(b){b!==a&&d.push(b)}),e.broadcasters=d,p()}}},e.rejoin=function(a){if(!e.isInitiator&&a&&Object.keys(a).length){var b={};e.peers[a.remoteUserId]&&(b=e.peers[a.remoteUserId].extra,e.deletePeer(a.remoteUserId)),a&&a.remoteUserId&&(e.join(a.remoteUserId),e.onReConnecting({userid:a.remoteUserId,extra:b}))}},e.join=e.connect=function(a,b,c){e.sessionid=!!a&&(a.sessionid||a.remoteUserId||a)||e.sessionid,e.sessionid+="";var d=!1,f=!1,h=!1,i=!1;if(a&&a.session||!a||"string"==typeof a){var j=a?a.session||e.session:e.session;h=!!j.oneway,i=w(j),f={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},d={OfferToReceiveAudio:h?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:h?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo}}b=b||{};var m=function(){};"function"==typeof b&&(m=b,b={}),void 0!==b.localPeerSdpConstraints&&(d=b.localPeerSdpConstraints),void 0!==b.remotePeerSdpConstraints&&(f=b.remotePeerSdpConstraints),void 0!==b.isOneWay&&(h=b.isOneWay),void 0!==b.isDataOnly&&(i=b.isDataOnly);var n={token:c,remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:h,isDataOnly:i,localPeerSdpConstraints:d,remotePeerSdpConstraints:f,token:c},sender:e.userid,password:!1};return l(n.message,function(){k(function(){e.peers[e.sessionid]||(g.onNegotiationNeeded(n),m())})}),n},e.connectWithAllParticipants=function(a){g.onNegotiationNeeded("connectWithAllParticipants",a||e.sessionid)},e.removeFromBroadcastersList=function(a){g.onNegotiationNeeded("removeFromBroadcastersList",a||e.sessionid),e.peers.getAllParticipants(a||e.sessionid).forEach(function(a){g.onNegotiationNeeded("dropPeerConnection",a),e.deletePeer(a)}),e.attachStreams.forEach(function(a){a.stop()})},e.getUserMedia=e.captureUserMedia=function(a,b){a=a||function(){};var c=b||e.session;if(e.dontCaptureUserMedia||w(c))return void a();(c.audio||c.video||c.screen)&&(c.screen?e.getScreenConstraints(function(d,f){if(d)throw d;e.invokeGetUserMedia({audio:!!A(e)&&B(f),video:f,isScreen:!0},function(d){if((c.audio||c.video)&&!A(e)){var f={};for(var g in c)"screen"!==g&&(f[g]=c[g]);return void e.invokeGetUserMedia(b,a,f)}a(d)})}):(c.audio||c.video)&&e.invokeGetUserMedia(b,a,c))},e.closeBeforeUnload=!0,window.addEventListener("beforeunload",m,!1),e.userid=s(),e.changeUserId=function(a,b){b=b||function(){},e.userid=a||s(),e.socket.emit("changed-uuid",e.userid,b)},e.extra={},e.attachStreams=[],e.session={audio:!0,video:!0},e.enableFileSharing=!1,e.bandwidth={screen:512,audio:128,video:512},e.codecs={audio:"opus",video:"VP9"},e.processSdp=function(a){return j||f?a:(a=K.setApplicationSpecificBandwidth(a,e.bandwidth,!!e.session.screen),a=K.setVideoBitrates(a,{min:8*e.bandwidth.video*1024,max:8*e.bandwidth.video*1024}),a=K.setOpusAttributes(a,{maxaveragebitrate:8*e.bandwidth.audio*1024,maxplaybackrate:8*e.bandwidth.audio*1024,stereo:1,maxptime:3}),"VP9"===e.codecs.video&&(a=K.preferVP9(a)),"H264"===e.codecs.video&&(a=K.removeVPX(a)),"G722"===e.codecs.audio&&(a=K.removeNonG722(a)),a)},void 0!==K&&(e.BandwidthHandler=e.CodecsHandler=K),e.mediaConstraints={audio:{mandatory:{},optional:[{bandwidth:8*e.bandwidth.audio*1024||1048576}]},video:{mandatory:{},optional:[{bandwidth:8*e.bandwidth.video*1024||1048576},{facingMode:"user"}]}},f&&(e.mediaConstraints={audio:!0,video:!0}),b.useDefaultDevices||j||DetectRTC.load(function(){var a,b;if(DetectRTC.MediaDevices.forEach(function(c){"audioinput"===c.kind&&!1!==e.mediaConstraints.audio&&(a=c),"videoinput"===c.kind&&!1!==e.mediaConstraints.video&&(b=c)}),a){if(f)return void(!0!==e.mediaConstraints.audio?e.mediaConstraints.audio.deviceId=a.id:e.mediaConstraints.audio={deviceId:a.id});1==e.mediaConstraints.audio&&(e.mediaConstraints.audio={mandatory:{},optional:[]}),e.mediaConstraints.audio.optional||(e.mediaConstraints.audio.optional=[]);var c=[{sourceId:a.id}];e.mediaConstraints.audio.optional=c.concat(e.mediaConstraints.audio.optional)}if(b){if(f)return void(!0!==e.mediaConstraints.video?e.mediaConstraints.video.deviceId=b.id:e.mediaConstraints.video={deviceId:b.id});1==e.mediaConstraints.video&&(e.mediaConstraints.video={mandatory:{},optional:[]}),e.mediaConstraints.video.optional||(e.mediaConstraints.video.optional=[]);var c=[{sourceId:b.id}];e.mediaConstraints.video.optional=c.concat(e.mediaConstraints.video.optional)}}),e.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},e.rtcpMuxPolicy="negotiate",e.iceTransportPolicy=null,e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},e.iceServers=M.getIceServers(e),e.candidates={host:!0,stun:!0,turn:!0},e.iceProtocols={tcp:!0,udp:!0},e.onopen=function(a){e.enableLogs&&console.info("Data connection has been opened between you & ",a.userid)},e.onclose=function(a){e.enableLogs&&console.warn("Data connection has been closed between you & ",a.userid)},e.onerror=function(a){e.enableLogs&&console.error(a.userid,"data-error",a)},e.onmessage=function(a){e.enableLogs},e.send=function(a,b){e.peers.send(a,b)},e.close=e.disconnect=e.leave=function(){m(!1,!0)},e.closeEntireSession=function(a){a=a||function(){},e.socket.emit("close-entire-session",function b(){if(e.getAllParticipants().length)return void setTimeout(b,100);e.onEntireSessionClosed({sessionid:e.sessionid,userid:e.userid,extra:e.extra}),e.changeUserId(null,function(){e.close(),a()})})},e.onEntireSessionClosed=function(a){e.enableLogs&&console.info("Entire session is closed: ",a.sessionid,a.extra)},e.onstream=function(a){var b=e.videosContainer;b.insertBefore(a.mediaElement,b.firstChild),a.mediaElement.play(),setTimeout(function(){a.mediaElement.play()},5e3)},e.onstreamended=function(a){a.mediaElement||(a.mediaElement=document.getElementById(a.streamid)),a.mediaElement&&a.mediaElement.parentNode&&a.mediaElement.parentNode.removeChild(a.mediaElement)},e.direction="many-to-many",e.removeStream=function(a,b){var c;if(e.attachStreams.forEach(function(b){b.id===a&&(c=b)}),!c)return void console.warn("No such stream exist.",a);e.peers.getAllParticipants().forEach(function(a){if(!b||a===b){var d=e.peers[a];try{d.peer.removeStream(c)}catch(a){}}}),e.renegotiate()},e.addStream=function(a,b){function c(c){a.streamCallback&&a.streamCallback(c),e.renegotiate(b)}return a.getAudioTracks?(-1===e.attachStreams.indexOf(a)&&(a.streamid||(a.streamid=a.id),e.attachStreams.push(a)),void e.renegotiate(b)):w(a)?void e.renegotiate(b):void((a.audio||a.video||a.screen)&&(a.screen?e.getScreenConstraints(function(b,d){if(b)return"PermissionDeniedError"===b?(a.streamCallback&&a.streamCallback(null),void(e.enableLogs&&console.error("User rejected to share his screen."))):alert(b);e.invokeGetUserMedia({audio:!!A(e)&&B(d),video:d,isScreen:!0},!a.audio&&!a.video||A(e)?c:e.invokeGetUserMedia(null,c))}):(a.audio||a.video)&&e.invokeGetUserMedia(null,c)))},e.invokeGetUserMedia=function(a,b,c){c||(c=e.session),a||(a=e.mediaConstraints),O({onGettingLocalMedia:function(c){var d=a.video;d&&(d.mediaSource||d.mozMediaSource?c.isScreen=!0:d.mandatory&&d.mandatory.chromeMediaSource&&(c.isScreen=!0)),c.isScreen||(c.isVideo=c.getVideoTracks().length,c.isAudio=!c.isVideo&&c.getAudioTracks().length),g.onGettingLocalMedia(c),b&&b(c)},onLocalMediaError:function(a,b){g.onLocalMediaError(a,b)},localMediaConstraints:a||{audio:!!c.audio&&a.audio,video:!!c.video&&a.video}})},e.applyConstraints=function(a,b){if(!I||!I.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(b){var c;return e.streamEvents[b]&&(c=e.streamEvents[b].stream),void n(c,a)}e.attachStreams.forEach(function(b){n(b,a)})},e.replaceTrack=function(a,b,c){function d(d){e.replaceTrack(d,b,c||a.video||a.screen)}if(a=a||{},!F.prototype.getSenders)return void e.addStream(a);if(a instanceof I)return void o(a,b,c);if(a instanceof z)return a.getVideoTracks().length&&o(a.getVideoTracks()[0],b,!0),void(a.getAudioTracks().length&&o(a.getAudioTracks()[0],b,!1));if(w(a))throw"connection.replaceTrack requires audio and/or video and/or screen.";(a.audio||a.video||a.screen)&&(a.screen?e.getScreenConstraints(function(b,c){if(b)return alert(b);e.invokeGetUserMedia({audio:!!A(e)&&B(c),video:c,isScreen:!0},!a.audio&&!a.video||A(e)?d:e.invokeGetUserMedia(null,d))}):(a.audio||a.video)&&e.invokeGetUserMedia(null,d))},e.resetTrack=function(a,b){a||(a=e.getAllParticipants()),"string"==typeof a&&(a=[a]),a.forEach(function(a){var c=e.peers[a].peer;void 0!==b&&!0!==b||!c.lastVideoTrack||e.replaceTrack(c.lastVideoTrack,a,!0),void 0!==b&&!1!==b||!c.lastAudioTrack||e.replaceTrack(c.lastAudioTrack,a,!1)})},e.renegotiate=function(a){if(a)return void g.renegotiatePeer(a);e.peers.getAllParticipants().forEach(function(a){g.renegotiatePeer(a)})},e.setStreamEndHandler=function(a,b){if(a&&a.addEventListener&&(b=!!b,!a.alreadySetEndHandler)){a.alreadySetEndHandler=!0;var c="ended";"oninactive"in a&&(c="inactive"),a.addEventListener(c,function(){if(a.idInstance&&currentUserMediaRequest.remove(a.idInstance),!b){var c=[];e.attachStreams.forEach(function(b){b.id!=a.id&&c.push(b)}),e.attachStreams=c}var d=e.streamEvents[a.streamid];if(d||(d={stream:a,streamid:a.streamid,type:b?"remote":"local",userid:e.userid,extra:e.extra,mediaElement:e.streamEvents[a.streamid]?e.streamEvents[a.streamid].mediaElement:null}),b&&e.peers[d.userid]){var f=e.peers[d.userid].peer,c=[];f.getRemoteStreams().forEach(function(b){b.id!=a.id&&c.push(b)}),e.peers[d.userid].streams=c}d.userid===e.userid&&"remote"===d.type||(e.peersBackup[d.userid]&&(d.extra=e.peersBackup[d.userid].extra),e.onstreamended(d),delete e.streamEvents[a.streamid])},!1)}},e.onMediaError=function(a,b){e.enableLogs&&console.error(a,b)},e.addNewBroadcaster=function(a,b){e.socket.isIO||(e.broadcasters.length&&setTimeout(function(){g.connectNewParticipantWithAllBroadcasters(a,b,e.broadcasters.join("|-,-|"))},1e4),e.session.oneway||e.session.broadcast||"many-to-many"!==e.direction||-1!==e.broadcasters.indexOf(a)||(e.broadcasters.push(a),p()))},e.autoCloseEntireSession=!1,e.filesContainer=e.videosContainer=document.body||document.documentElement,e.isInitiator=!1,e.shareFile=g.shareFile,void 0!==_&&_.handle(e),void 0!==aa&&aa.handle(e),e.token=s,e.onNewParticipant=function(a,b){e.acceptParticipationRequest(a,b)},e.acceptParticipationRequest=function(a,b){b.successCallback&&(b.successCallback(),delete b.successCallback),g.createNewPeer(a,b)},e.onShiftedModerationControl=function(a,b){e.acceptModerationControl(a,b)},e.acceptModerationControl=function(a,b){e.isInitiator=!0,e.broadcasters=b,e.peers.getAllParticipants().forEach(function(b){g.onNegotiationNeeded({changedUUID:a,oldUUID:e.userid,newUUID:a},b)}),e.userid=a,e.changeUserId(e.userid)},e.shiftModerationControl=function(a,b,c){g.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:b,firedOnLeave:!!c},a)},void 0!==P&&(e.StreamsHandler=P),e.onleave=function(a){},e.invokeSelectFileDialog=function(a){var b=new FileSelector;b.accept="*.*",b.selectSingleFile(a)},e.getPublicModerators=function(a,b){"function"==typeof a&&(b=a),k(function(){e.socket.emit("get-public-moderators","string"==typeof a?a:"",b)})},e.onmute=function(a){a&&a.mediaElement&&("both"===a.muteType||"video"===a.muteType?(a.mediaElement.src=null,a.mediaElement.pause(),a.mediaElement.poster=a.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===a.muteType&&(a.mediaElement.muted=!0))},e.onunmute=function(a){a&&a.mediaElement&&a.stream&&("both"===a.unmuteType||"video"===a.unmuteType?(a.mediaElement.poster=null,a.mediaElement.src=URL.createObjectURL(a.stream),a.mediaElement.play()):"audio"===a.unmuteType&&(a.mediaElement.muted=!1))},e.onExtraDataUpdated=function(a){a.status="online",e.onUserStatusChanged(a,!0)},e.onJoinWithPassword=function(a){console.warn(a,"is password protected. Please join with password.")},e.onInvalidPassword=function(a,b){console.warn(a,"is password protected. Please join with valid password. Your old password",b,"is wrong.")},e.onPasswordMaxTriesOver=function(a){console.warn(a,"is password protected. Your max password tries exceeded the limit.")},e.getAllParticipants=function(a){return e.peers.getAllParticipants(a)},void 0!==P&&(P.onSyncNeeded=function(a,b,c){e.peers.getAllParticipants().forEach(function(d){g.onNegotiationNeeded({streamid:a,action:b,streamSyncNeeded:!0,type:c||"both"},d)})}),e.connectSocket=function(a){k(a)},e.closeSocket=function(){try{io.sockets={}}catch(a){}e.socket&&("function"==typeof e.socket.disconnect&&e.socket.disconnect(),"function"==typeof e.socket.resetProps&&e.socket.resetProps(),e.socket=null)},e.getSocket=function(a){return e.socket?a&&a(e.socket):k(a),e.socket},e.getRemoteStreams=g.getRemoteStreams;var v=["selectFirst","selectAll","forEach"];if(e.streamEvents={selectFirst:function(a){if(!a){var b;for(var c in e.streamEvents)-1!==v.indexOf(c)||b||(b=e.streamEvents[c]);return b}},selectAll:function(){}},e.socketURL="/",e.socketMessageEvent="RTCMultiConnection-Message",e.socketCustomEvent="RTCMultiConnection-Custom-Message",e.DetectRTC=DetectRTC,e.setCustomSocketEvent=function(a){a&&(e.socketCustomEvent=a),e.socket&&e.socket.emit("set-custom-socket-event-listener",e.socketCustomEvent)},e.getNumberOfBroadcastViewers=function(a,b){e.socket&&a&&b&&e.socket.emit("get-number-of-users-in-specific-broadcast",a,b)},e.onNumberOfBroadcastViewersUpdated=function(a){e.enableLogs&&e.isInitiator&&console.info("Number of broadcast (",a.broadcastId,") viewers",a.numberOfBroadcastViewers)},e.onUserStatusChanged=function(a,b){e.enableLogs&&!b&&console.info(a.userid,a.status)},e.getUserMediaHandler=O,e.multiPeersHandler=g,e.enableLogs=!0,e.setCustomSocketHandler=function(a){void 0!==c&&(c=a)},e.chunkSize=65e3,e.maxParticipantsAllowed=1e3,e.disconnectWith=g.disconnectWith,e.checkPresence=function(a,b){if(!e.socket)return void e.connectSocket(function(){e.checkPresence(a,b)});e.socket.emit("check-presence",(a||e.sessionid)+"",b)},e.onReadyForOffer=function(a,b){e.multiPeersHandler.createNewPeer(a,b)},e.setUserPreferences=function(a){return e.dontAttachStream&&(a.dontAttachLocalStream=!0),e.dontGetRemoteStream&&(a.dontGetRemoteStream=!0),a},e.updateExtraData=function(){e.socket.emit("extra-data-updated",e.extra)},e.enableScalableBroadcast=!1,e.maxRelayLimitPerUser=3,e.dontCaptureUserMedia=!1,e.dontAttachStream=!1,e.dontGetRemoteStream=!1,e.onReConnecting=function(a){e.enableLogs&&console.info("ReConnecting with",a.userid,"...")},e.beforeAddingStream=function(a){return a},e.beforeRemovingStream=function(a){return a},void 0!==U&&(e.checkIfChromeExtensionAvailable=U),void 0!==V&&(e.checkIfChromeExtensionAvailable=V),void 0!==X&&(e.getChromeExtensionStatus=X),e.getScreenConstraints=function(a,b){A(e,b)&&(b=!0),Y(function(b,c){b||(c=e.modifyScreenConstraints(c),a(b,c))},b)},e.modifyScreenConstraints=function(a){return a},e.onPeerStateChanged=function(a){e.enableLogs&&-1!==a.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",a.userid,a.extra,"state:",a.iceConnectionState)},e.isOnline=!0,u("online",function(){e.isOnline=!0}),u("offline",function(){e.isOnline=!1}),e.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(e.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),e.isLowBandwidth)){if(e.bandwidth={audio:30,video:30,screen:30},e.mediaConstraints.audio&&e.mediaConstraints.audio.optional&&e.mediaConstraints.audio.optional.length){var x=[];e.mediaConstraints.audio.optional.forEach(function(a){void 0===a.bandwidth&&x.push(a)}),e.mediaConstraints.audio.optional=x}if(e.mediaConstraints.video&&e.mediaConstraints.video.optional&&e.mediaConstraints.video.optional.length){var x=[];e.mediaConstraints.video.optional.forEach(function(a){void 0===a.bandwidth&&x.push(a)}),e.mediaConstraints.video.optional=x}}e.getExtraData=function(a){if(!a)throw"remoteUserId is required.";return e.peers[a]?e.peers[a].extra:{}},b.autoOpenOrJoin&&e.openOrJoin(e.sessionid),e.onUserIdAlreadyTaken=function(a,b){e.enableLogs&&console.warn("Userid already taken.",a,"Your new userid:",b),e.join(a)},e.onRoomFull=function(a){e.enableLogs&&console.warn(a,"is full.")},e.trickleIce=!0,e.version="3.4.4",e.onSettingLocalDescription=function(a){e.enableLogs&&console.info("Set local description for remote user",a.userid)},e.oneRoomAlreadyExist=function(a){e.enableLogs&&console.info('Server says "Room ',a,"already exist. Joining instead."),e.join(a)}}(this)};
